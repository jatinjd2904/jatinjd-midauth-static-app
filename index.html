<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home - Power Pages Auth Demo</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
</head>
<body>
  <!-- Header with Navigation -->
  <header class="site-header">
    <div class="header-container">
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="support-auth.html">Support (Authenticated)</a>
        <a href="support-unauth.html">Support (Unauthenticated)</a>
        <a href="reconnect.html">Support (Reconnect)</a>
      </nav>
      <div class="auth-section">
        <span class="user-info" id="user-info-text"></span>
        <button id="auth-button" class="auth-button" onclick="login()">Login</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <h1 class="page-title">Welcome to Power Pages Auth Demo</h1>
    <p class="page-description">
      This application demonstrates Microsoft Power Pages-style authentication behavior with Microsoft Omnichannel chat widgets.
      Users can authenticate optionally, and authentication never blocks access to any page or widget.
    </p>

    <!-- Info Box -->
    <div class="info-box">
      <h3>How Authentication Works</h3>
      <p>
        <strong>Login:</strong> Clicking login will redirect you to Azure AD authentication and bring you back to the same page.<br>
        <strong>Logout:</strong> Clicking logout will sign you out and keep you on the current page (no redirect).<br>
        <strong>Page Access:</strong> All pages and widgets are accessible whether you're logged in or not.
      </p>
    </div>

    <!-- Feature Cards -->
    <div class="card">
      <h2>Authenticated Chat Support</h2>
      <p>
        Visit the <a href="support-auth.html">Authenticated Support</a> page to access the chat widget that requires authentication.
        If you log in while chatting, your session will be upgraded to authenticated mode using mid-authentication.
      </p>
    </div>

    <div class="card">
      <h2>Unauthenticated Chat Support</h2>
      <p>
        Visit the <a href="support-unauth.html">Unauthenticated Support</a> page to access the chat widget that works without authentication.
        This widget is accessible to everyone, including logged-in users. It supports optional mid-authentication if you log in during your session.
      </p>
    </div>

    <div class="card">
      <h2>Reconnect Chat Support</h2>
      <p>
        Visit the <a href="reconnect.html">Reconnect Support</a> page to access another chat widget instance.
        This widget clears chat context on logout, similar to authenticated chat behavior.
      </p>
    </div>

    <div class="card">
      <h2>Key Features</h2>
      <ul style="margin-left: 20px; line-height: 2;">
        <li>Azure AD authentication using MSAL.js</li>
        <li>Login redirects back to the originating page</li>
        <li>Logout stays on the current page</li>
        <li>All pages accessible regardless of auth state</li>
        <li>Mid-authentication support for chat widgets</li>
        <li>Persistent auth state across page reloads</li>
      </ul>
    </div>

    <!-- User Info Display -->
    <div id="user-info" class="user-info-display" style="display: none;">
      <h3>Current User Information</h3>
      <pre id="user-info-json"></pre>
    </div>
  </main>

  <!-- Auth Script -->
  <script src="auth.js"></script>

  <!-- Page-specific Script -->
  <script>
    // Display user info if authenticated
    document.addEventListener('DOMContentLoaded', () => {
      // Check auth state after a short delay to ensure MSAL is ready
      setTimeout(() => {
        const user = getCurrentUser();
        if (user) {
          const userInfoDiv = document.getElementById('user-info');
          const userInfoJson = document.getElementById('user-info-json');

          if (userInfoDiv && userInfoJson) {
            userInfoDiv.style.display = 'block';
            userInfoJson.textContent = JSON.stringify(user, null, 2);
          }
        }
      }, 500);
    });
  </script>
</body>
</html>
